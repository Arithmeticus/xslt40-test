<?xml version="1.0" encoding="UTF-8"?>
<test-set xmlns:xs="http://www.w3.org/2001/XMLSchema"
   xmlns="http://www.w3.org/2012/10/xslt-test-catalog"
   name="array">
   <description>Tests XSLT 4.0 extensions for arrays, notably the xsl:array instruction</description>
   
   <environment name="array-A">
      <source role="." file="../../strm/docs/transactions.xml"/>
   </environment>
   
   <dependencies>
      <spec value="XSLT40+"/>
   </dependencies>
   
   <test-case name="array-001">
      <description>Simple test of xsl:array with a sequence constructor</description>
      <created by="Michael Kay" on="2016-12-19"/>
      <test>
         <stylesheet file="array-001.xsl"/>
      </test>
      <result>
         <all-of>
            <assert>/out/@count = '10'</assert>
            <assert>/out/@values = '1 2 3 4 5 6 7 8 9 10'</assert>
            <assert>/out/@last = '10'</assert>
         </all-of>
      </result>
   </test-case>
   
   <test-case name="array-001b">
      <description>Simple test of xsl:array with a sequence constructor, when not available</description>
      <created by="Debbie Lockett" on="2020-03-10"/>
      <dependencies>
         <spec value="XSLT30"/>
      </dependencies>
      <test>
         <stylesheet file="array-001.xsl"/>
      </test>
      <result>
         <error code="XTDE1450"/>
      </result>
   </test-case>
   
   <test-case name="array-002">
      <description>Simple test of xsl:array with a select attribute</description>
      <created by="Michael Kay" on="2016-12-19"/>
      <test>
         <stylesheet file="array-002.xsl"/>
      </test>
      <result>
         <all-of>
            <assert>/out/@count = '10'</assert>
            <assert>/out/@values = '1 2 3 4 5 6 7 8 9 10'</assert>
            <assert>/out/@last = '10'</assert>
         </all-of>
      </result>
   </test-case>
   
   <test-case name="array-002b">
      <description>Simple test of xsl:array with a select attribute, when not available</description>
      <created by="Debbie Lockett" on="2020-03-10"/>
      <dependencies>
         <spec value="XSLT30"/>
      </dependencies>
      <test>
         <stylesheet file="array-002.xsl"/>
      </test>
      <result>
         <error code="XTDE1450"/>
      </result>
   </test-case>
   
   <test-case name="array-003">
      <description>Nested arrays</description>
      <created by="Michael Kay" on="2016-12-19"/>
      <environment ref="array-A"/>
      <test>
         <stylesheet file="array-003.xsl"/>
         <output serialize="yes" tree="no"/>
      </test>
      <result>
         <assert-serialization>[["13.24","8.12"],["-15.00"],["6.00"],["0.50","2.33","4.44"],["-5.00"],["8.99"],["16.00"],["-2.33","5.60","4.32"],["6.78","12.20","-248.05"],["12.00","13.99"],["14.20"]]</assert-serialization>
      </result>
   </test-case>
   
   <test-case name="array-004">
      <description>Arrays containing sequences</description>
      <created by="Michael Kay" on="2017-01-11"/>
      <test>
         <stylesheet file="array-004.xsl"/>
      </test>
      <result>
         <assert>/out[@ok="true"]</assert>
      </result>
   </test-case>
   
   <test-case name="array-005">
      <description>Arrays containing sequences</description>
      <created by="Michael Kay" on="2017-01-11"/>
      <test>
         <stylesheet file="array-005.xsl"/>        
      </test>
      <result>
         <assert>/out[@ok="true"]</assert>
      </result>
   </test-case>
   
   <test-case name="array-006">
      <description>Arrays containing sequences</description>
      <created by="Michael Kay" on="2017-01-11"/>
      <test>
         <stylesheet file="array-006.xsl"/>        
      </test>
      <result>
         <assert>/out[@ok="true"]</assert>
      </result>
   </test-case>
 
   <test-case name="array-007">
      <description>Streaming with arrays - Saxon bug 3599 - streaming on</description>
      <created by="Michael Kay" on="2018-01-05"/>
      <environment>
         <source file="array-007.xml" role="." streaming="true"/>
      </environment>
      <dependencies>
         <feature value="streaming"/>
      </dependencies>
      <test>
         <stylesheet file="array-007.xsl"/>
         <param name="STREAMABLE" static="true" select="true()"/>
      </test>
      <result>
         <all-of>
            <assert>contains(/out, '"cities":["Milano","Venezia"]')</assert>
            <assert>contains(/out, '"cities":["Paris","Lyon"]')</assert>
         </all-of>
      </result>
   </test-case>
   
   <test-case name="array-008">
      <description>Streaming with arrays - Saxon bug 3599 - streaming off</description>
      <created by="Michael Kay" on="2018-01-05"/>
      <environment>
         <source file="array-007.xml" role="." streaming="true"/>
      </environment>
      <dependencies>
         <feature value="streaming"/>
      </dependencies>
      <test>
         <stylesheet file="array-007.xsl"/>
         <param name="STREAMABLE" static="true" select="false()"/>
      </test>
      <result>
         <all-of>
            <assert>contains(/out, '"cities":["Milano","Venezia"]')</assert>
            <assert>contains(/out, '"cities":["Paris","Lyon"]')</assert>
         </all-of>
      </result>
   </test-case>
   
 <!--  <test-case name="array-009">
      <description>Saxon "for member" extension</description>
      <created by="Michael Kay" on="2019-04-03"/>
      <environment>
         <saxon:property name="http://saxon.sf.net/feature/allowSyntaxExtensions" value="true" xmlns:saxon="http://saxon.sf.net/"/>
      </environment>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="Saxon-PE"/>
      </dependencies>
      <test>
         <stylesheet file="array-009.xsl"/>
      </test>
      <result>
         <assert>/out = "2 3 4 5"</assert>
      </result>
   </test-case>
   
   <test-case name="array-009b">
      <description>Saxon "for member" extension, when not available</description>
      <created by="Debbie Lockett" on="2020-03-10"/>
      <environment>
         <saxon:property name="http://saxon.sf.net/feature/allowSyntaxExtensions" value="true" xmlns:saxon="http://saxon.sf.net/"/>
      </environment>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="Saxon-PE" satisfied="false"/>
      </dependencies>
      <test>
         <stylesheet file="array-009.xsl"/>
      </test>
      <result>
         <error code="XPST0003"/>
      </result>
   </test-case>
   
   <test-case name="array-020">
      <description>saxon:for-each-member extension</description>
      <created by="Michael Kay" on="2019-04-03"/>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="Saxon-PE"/>
      </dependencies>
      <test>
         <stylesheet file="array-020.xsl"/>
      </test>
      <result>
         <all-of>
            <assert>/out/in[1] = 1</assert>
            <assert>/out/in[2] = 11</assert>
            <assert>/out/in[3] = 10</assert>
         </all-of>
      </result>
   </test-case>
   
   <test-case name="array-020b">
      <description>saxon:for-each-member extension, when not available</description>
      <created by="Debbie Lockett" on="2020-03-10"/>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="Saxon-PE" satisfied="false"/>
      </dependencies>
      <test>
         <stylesheet file="array-020.xsl"/>
      </test>
      <result>
         <error code="XTDE1450"/>
      </result>
   </test-case>
   
   <test-case name="array-021">
      <description>saxon:for-each-member extension; type error, select must be an array</description>
      <created by="Michael Kay" on="2019-04-03"/>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="Saxon-PE"/>
      </dependencies>
      <test>
         <stylesheet file="array-021.xsl"/>
      </test>
      <result>
         <error code="XPTY0004"/>
      </result>
   </test-case>
   
   <test-case name="array-022">
      <description>saxon:for-each-member extension; JSON example</description>
      <created by="Michael Kay" on="2019-04-03"/>
      <environment>
         <saxon:property name="http://saxon.sf.net/feature/allowSyntaxExtensions" value="true" xmlns:saxon="http://saxon.sf.net/"/>
      </environment>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="Saxon-PE"/>
      </dependencies>
      <test>
         <stylesheet file="array-022.xsl"/>
      </test>
      <result>
         <assert>/out = "RU TJ"</assert>
      </result>
   </test-case>
  
  <test-case name="array-023">
    <description>template matching array of atomic values</description>
    <created by="Michael Kay" on="2020-01-30"/>
    <environment>
      <saxon:property name="http://saxon.sf.net/feature/allowSyntaxExtensions" value="true" xmlns:saxon="http://saxon.sf.net/"/>
    </environment>
    <dependencies>
      <spec value="XSLT30+"/>
      <feature value="Saxon-PE"/>
    </dependencies>
    <test>
      <stylesheet file="array-023.xsl"/>
    </test>
    <result>
      <assert>/out/L/I/D = '42'</assert>
    </result>
  </test-case>
   
   <test-case name="array-023b">
      <description>template matching array of atomic values, when not available</description>
      <created by="Debbie Lockett" on="2020-03-10"/>
      <environment>
         <saxon:property name="http://saxon.sf.net/feature/allowSyntaxExtensions" value="true" xmlns:saxon="http://saxon.sf.net/"/>
      </environment>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="Saxon-PE" satisfied="false"/>
      </dependencies>
      <test>
         <stylesheet file="array-023.xsl"/>
      </test>
      <result>
         <error code="XTSE0340"/>
      </result>
   </test-case>
  
  <test-case name="array-024">
    <description>template matching array of maps (from JSON)</description>
    <created by="Michael Kay" on="2020-01-30"/>
    <environment>
      <saxon:property name="http://saxon.sf.net/feature/allowSyntaxExtensions" value="true" xmlns:saxon="http://saxon.sf.net/"/>
    </environment>
    <dependencies>
      <spec value="XSLT30+"/>
      <feature value="Saxon-PE"/>
    </dependencies>
    <test>
      <stylesheet file="array-024.xsl"/>
    </test>
    <result>
      <all-of>
        <assert>/out/AT/P[@first='Sue'][@last='Schreiber']</assert>
        <assert>/out/AT/P[@first='Debbie'][@last='Lockett']</assert>
      </all-of>
    </result>
  </test-case>
   
   <test-case name="array-024b">
      <description>template matching array of maps (from JSON), when not available</description>
      <created by="Debbie Lockett" on="2020-03-10"/>
      <environment>
         <saxon:property name="http://saxon.sf.net/feature/allowSyntaxExtensions" value="true" xmlns:saxon="http://saxon.sf.net/"/>
      </environment>
      <dependencies>
         <spec value="XSLT30+"/>
         <feature value="Saxon-PE" satisfied="false"/>
      </dependencies>
      <test>
         <stylesheet file="array-024.xsl"/>
      </test>
      <result>
         <error code="XTSE0340"/>
      </result>
   </test-case>
   
   -->
   
</test-set>